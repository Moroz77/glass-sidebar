<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Калиновая баня — автономный сайт</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <!-- Используем существующий стиль сайдбара из корня репозитория -->
    <link rel="stylesheet" href="../style.css" />

    <!-- Встроенный умный виджет бронирования (mini iframe + fullscreen overlay) -->
    <style>
      :root{ --kb-sidebar-width: 260px; }

      /* Мини‑виджет: внутренняя FAB из booking/ */
      #kb-mini-frame{
        position: fixed;
        right: 18px;
        bottom: 18px;
        width: 120px;
        height: 120px;
        border: 0;
        background: transparent;
        z-index: 2147483500; /* выше сайдбара, ниже фулскрина */
      }
      @media (max-width:600px){ #kb-mini-frame{ width:100px; height:100px; } }

      /* Полноэкранный оверлей + iframe */
      #kb-full-overlay{
        position: fixed; inset: 0;
        display: none; align-items: stretch;
        background: transparent; z-index: 2147483600;
      }
      #kb-full-overlay.is-open{ display: flex; }
      /* Не закрываем левый сайдбар на десктопе */
      @media (min-width:1025px){ #kb-full-overlay{ left: var(--kb-sidebar-width); } }

      #kb-full-frame{ flex:1; border:0; background:transparent; width:100%; height:100%; }
      .kb-overlay-close{
        position: fixed; top: 12px; right: 12px; z-index: 2147483601;
        width: 44px; height: 44px; border: 0; border-radius: 50%;
        background: rgba(0,0,0,.6); color: #fff; font-size: 28px; line-height: 44px; cursor: pointer;
      }
      html.kb-noscroll, body.kb-noscroll{ overflow: hidden !important; }
    </style>
  </head>
  <body>
    <!-- Левый стеклянный сайдбар (как на главной) -->
    <aside class="sidebar">
      <div class="logo">
        <img src="../images/logo.jpg" alt="logo">
        <h2>Калиновая баня</h2>
      </div>
      <ul class="links">
        <h4>Меню</h4>
        <li>
          <span class="material-symbols-outlined">dashboard</span>
          <a href="#">Главная</a>
        </li>
        <li>
          <span class="material-symbols-outlined">show_chart</span>
          <a href="#">Прайс</a>
        </li>
        <li>
          <span class="material-symbols-outlined">flag</span>
          <a href="#">Отчёты</a>
        </li>
        <hr>
        <h4>Дополнительно</h4>
        <li>
          <span class="material-symbols-outlined">person</span>
          <a href="#">Команда</a>
        </li>
        <li>
          <span class="material-symbols-outlined">group</span>
          <a href="#">Гости</a>
        </li>
        <li>
          <span class="material-symbols-outlined">monitoring</span>
          <a href="#">Аналитика</a>
        </li>
        <hr>
        <h4>Аккаунт</h4>
        <li>
          <span class="material-symbols-outlined">mail</span>
          <a href="#">Сообщения</a>
        </li>
        <li>
          <span class="material-symbols-outlined">settings</span>
          <a href="#">Настройки</a>
        </li>
        <li class="logout-link">
          <span class="material-symbols-outlined">logout</span>
          <a href="#">Выйти</a>
        </li>
      </ul>
    </aside>

    <!-- Мини‑фрейм с внутренней FAB -->
    <iframe
      id="kb-mini-frame"
      title="Калиновая баня — кнопка бронирования"
      src="../booking/"
      referrerpolicy="no-referrer">
    </iframe>

    <!-- Фулскрин с открытой карточкой -->
    <div id="kb-full-overlay" aria-hidden="true">
      <iframe
        id="kb-full-frame"
        title="Калиновая баня — бронирование"
        src="about:blank"
        referrerpolicy="no-referrer">
      </iframe>
      <button class="kb-overlay-close" aria-label="Закрыть">×</button>
    </div>

    <script>
      (function(){
        var FULL_SRC = '../booking/#kb-booking';
        var mini = document.getElementById('kb-mini-frame');
        var overlay = document.getElementById('kb-full-overlay');
        var full = document.getElementById('kb-full-frame');
        var closeBtn = overlay.querySelector('.kb-overlay-close');
        function isMobile(){ return window.innerWidth <= 1024; }
        function lockScroll(on){ if (isMobile()) { document.documentElement.classList.toggle('kb-noscroll', on); document.body.classList.toggle('kb-noscroll', on); } }
        function openOverlay(){ if (full.src !== FULL_SRC) full.src = FULL_SRC; overlay.classList.add('is-open'); lockScroll(true); }
        function closeOverlay(){ overlay.classList.remove('is-open'); lockScroll(false); }

        // Слушаем события из booking/ (postMessage)
        window.addEventListener('message', function(e){
          // Внутренний iframe того же домена — принимаем все события
          var d = e.data || {};
          if (d.source === 'kb') {
            if (d.type === 'kb-open') openOverlay();
            else if (d.type === 'kb-close') closeOverlay();
          }
        });

        closeBtn.addEventListener('click', function(e){ e.preventDefault(); closeOverlay(); });
        overlay.addEventListener('click', function(e){ if (e.target === overlay) closeOverlay(); });
        window.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeOverlay(); });
        window.addEventListener('resize', function(){ if (!overlay.classList.contains('is-open')) return; if (isMobile()) lockScroll(true); else lockScroll(false); });
      })();
    </script>
  </body>
</html>

