<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Калиновая баня — автономный сайт</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <!-- Используем существующий стиль сайдбара из корня репозитория -->
    <link rel="stylesheet" href="../style.css" />

    <!-- Встроенный умный виджет бронирования (mini iframe + fullscreen overlay) -->
    <style>
      :root{ --kb-sidebar-width: 260px; }

      /* Мини‑виджет: внутренняя FAB из booking/ */
      #kb-mini-frame{
        position: fixed;
        right: 18px;
        bottom: 18px;
        width: 120px;
        height: 120px;
        border: 0;
        background: transparent;
        z-index: 2147483500; /* выше сайдбара, ниже фулскрина */
      }
      @media (max-width:600px){ #kb-mini-frame{ width:100px; height:100px; } }

      /* Полноэкранный оверлей + iframe */
      #kb-full-overlay{
        position: fixed; inset: 0;
        display: none; align-items: stretch;
        background: transparent; z-index: 2147483600;
      }
      #kb-full-overlay.is-open{ display: flex; }
      /* Не закрываем левый сайдбар на десктопе */
      @media (min-width:1025px){ #kb-full-overlay{ left: var(--kb-sidebar-width); } }
      /* На мобильных прячем мини‑кнопку при открытом оверлее */
      @media (hover:none), (pointer:coarse){ .kb-overlay-open #kb-mini-frame{ display:none !important; } }
      /* На десктопе во время оверлея отключаем клики по мини‑кнопке и поднимаем z-index */
      .kb-overlay-open #kb-mini-frame{ pointer-events:none; z-index:2147483602; }

      #kb-full-frame{ flex:1; border:0; background:transparent; width:100%; height:100%; }
      .kb-overlay-close{
        position: fixed; top: 12px; right: 12px; z-index: 2147483601;
        width: 44px; height: 44px; border: 0; border-radius: 50%;
        background: rgba(0,0,0,.6); color: #fff; font-size: 28px; line-height: 44px; cursor: pointer;
      }
      html.kb-noscroll, body.kb-noscroll{ overflow: hidden !important; }

      /* Нативная кнопка “Калькулятор” (без iframe) */
      #kb-open-btn{
        position: fixed;
        right: 18px; bottom: 18px;
        z-index: 2147483500; /* выше сайдбара, ниже оверлея */
        display: inline-block;
        width: 110px; height: 110px; /* можно поменять */
        border-radius: 50%;
        background: url("https://static.tildacdn.com/tild6338-3661-4465-b332-643665333939/ChatGPT_Image_12__20.png") center/contain no-repeat;
        filter: drop-shadow(0 8px 20px rgba(0,0,0,.45));
        transition: transform .2s ease, filter .2s ease;
        cursor: pointer;
      }
      #kb-open-btn:hover{ transform: scale(1.04); filter: drop-shadow(0 10px 25px rgba(0,0,0,.55)); }
      #kb-open-btn:active{ transform: scale(.98); }
      @media (max-width:600px){ #kb-open-btn{ width: 92px; height: 92px; } }

      /* На мобильных скрываем кнопку во время открытого оверлея */
      @media (hover:none), (pointer:coarse){ .kb-overlay-open #kb-open-btn{ display:none !important; } }
    </style>
  </head>
  <body>
    <!-- Левый стеклянный сайдбар (как на главной) -->
    <aside class="sidebar">
      <div class="logo">
        <img src="../images/logo.jpg" alt="logo">
        <h2>Калиновая баня</h2>
      </div>
      <ul class="links">
        <h4>Меню</h4>
        <li>
          <span class="material-symbols-outlined">dashboard</span>
          <a href="#">Главная</a>
        </li>
        <li>
          <span class="material-symbols-outlined">show_chart</span>
          <a href="#">Прайс</a>
        </li>
        <li>
          <span class="material-symbols-outlined">flag</span>
          <a href="#">Отчёты</a>
        </li>
        <hr>
        <h4>Дополнительно</h4>
        <li>
          <span class="material-symbols-outlined">person</span>
          <a href="#">Команда</a>
        </li>
        <li>
          <span class="material-symbols-outlined">group</span>
          <a href="#">Гости</a>
        </li>
        <li>
          <span class="material-symbols-outlined">monitoring</span>
          <a href="#">Аналитика</a>
        </li>
        <hr>
        <h4>Аккаунт</h4>
        <li>
          <span class="material-symbols-outlined">mail</span>
          <a href="#">Сообщения</a>
        </li>
        <li>
          <span class="material-symbols-outlined">settings</span>
          <a href="#">Настройки</a>
        </li>
        <li class="logout-link">
          <span class="material-symbols-outlined">logout</span>
          <a href="#">Выйти</a>
        </li>
      </ul>
    </aside>

    <!-- Нативная кнопка “Калькулятор” -->
    <a id="kb-open-btn" aria-label="Открыть бронирование" title="Бронирование"></a>

    <!-- Фулскрин с открытой карточкой -->
    <div id="kb-full-overlay" aria-hidden="true">
      <iframe
        id="kb-full-frame"
        title="Калиновая баня — бронирование"
        src="about:blank"
        referrerpolicy="no-referrer">
      </iframe>
      <button class="kb-overlay-close" aria-label="Закрыть">×</button>
    </div>

    <script>
      (function(){
        var FULL_SRC = '../booking/?hidefab=1#kb-booking';
        var openBtn = document.getElementById('kb-open-btn');
        var overlay = document.getElementById('kb-full-overlay');
        var full = document.getElementById('kb-full-frame');
        var closeBtn = overlay.querySelector('.kb-overlay-close');
        function isMobile(){
          try { return window.matchMedia('(hover: none), (pointer: coarse)').matches; }
          catch(_) { return window.innerWidth <= 1024; }
        }
        function lockScroll(on){ if (isMobile()) { document.documentElement.classList.toggle('kb-noscroll', on); document.body.classList.toggle('kb-noscroll', on); } }
        function openOverlay(){ if (full.src !== FULL_SRC) full.src = FULL_SRC; overlay.classList.add('is-open'); document.documentElement.classList.add('kb-overlay-open'); lockScroll(true); }
        function closeOverlay(){ overlay.classList.remove('is-open'); document.documentElement.classList.remove('kb-overlay-open'); lockScroll(false); }

        // Слушаем события из booking/ (postMessage)
        window.addEventListener('message', function(e){
          // Внутренний iframe того же домена — принимаем все события
          var d = e.data || {};
          if (d.source === 'kb') {
            if (d.type === 'kb-open') openOverlay();
            else if (d.type === 'kb-close') closeOverlay();
          }
        });

        closeBtn.addEventListener('click', function(e){ e.preventDefault(); closeOverlay(); });
        overlay.addEventListener('click', function(e){ if (e.target === overlay) closeOverlay(); });
        window.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeOverlay(); });
        window.addEventListener('resize', function(){ if (!overlay.classList.contains('is-open')) return; if (isMobile()) lockScroll(true); else lockScroll(false); });
        // На старте сбросим класс (кнопка всегда видима как нативная)
        document.documentElement.classList.remove('kb-overlay-open');
        // Клик по нативной кнопке
        if (openBtn) openBtn.addEventListener('click', function(e){ e.preventDefault(); openOverlay(); });
      })();
    </script>
  </body>
</html>
