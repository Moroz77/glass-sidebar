<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Калиновая баня — автономный сайт</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <!-- Используем существующий стиль сайдбара из корня репозитория -->
    <link rel="stylesheet" href="../style.css" />

    <!-- Встроенный умный виджет бронирования (mini iframe + fullscreen overlay) -->
    <style>
      :root{ --kb-sidebar-width: 260px; }
      html, body { min-height: 100%; }
      /* Фоновое изображение главной страницы (можно заменить путь на свой) */
      body{
        background-image: url('../images/hero-bg.jpg') !important;
        background-position: center !important;
        background-size: cover !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
        background-color: #000 !important; /* fallback */
      }

      /* Мини‑виджет: внутренняя FAB из booking/ */
      #kb-mini-frame{
        position: fixed;
        right: 18px;
        bottom: 18px;
        width: 120px;
        height: 120px;
        border: 0;
        background: transparent;
        z-index: 2147483500; /* выше сайдбара, ниже фулскрина */
      }
      @media (max-width:600px){ #kb-mini-frame{ width:100px; height:100px; } }

      /* Полноэкранный оверлей + iframe */
      #kb-full-overlay{
        position: fixed; inset: 0;
        display: none; align-items: stretch;
        background: transparent; z-index: 2147483600;
      }
      #kb-full-overlay.is-open{ display: flex; }
      /* Не закрываем левый сайдбар на десктопе */
      @media (min-width:1025px){ #kb-full-overlay{ left: var(--kb-sidebar-width); } }
      /* На мобильных прячем мини‑кнопку при открытом оверлее */
      @media (hover:none), (pointer:coarse){ .kb-overlay-open #kb-mini-frame{ display:none !important; } }
      /* На десктопе во время оверлея отключаем клики по мини‑кнопке и поднимаем z-index */
      .kb-overlay-open #kb-mini-frame{ pointer-events:none; z-index:2147483602; }

      #kb-full-frame{ flex:1; border:0; background:transparent; width:100%; height:100%; }
      html.kb-noscroll, body.kb-noscroll{ overflow: hidden !important; }

      /* Нативная кнопка “Калькулятор” в стиле стекла (как сайдбар и бронь) */
      #kb-open-btn{
        position: fixed;
        right: 18px; bottom: 18px;
        z-index: 2147483500; /* выше сайдбара, ниже оверлея */
        display: inline-block; position: fixed;
        width: 110px; height: 110px; /* можно поменять */
        border-radius: 50%;
        background: rgba(255,255,255,.16);
        -webkit-backdrop-filter: blur(18px) saturate(160%);
        backdrop-filter: blur(18px) saturate(160%);
        border: 1px solid rgba(255,255,255,.35);
        background-clip: padding-box;
        box-shadow: 0 8px 22px rgba(0,0,0,.26);
        transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
        cursor: pointer;
        overflow: hidden;
      }
      #kb-open-btn::before{
        content: "";
        position: absolute; inset: 14px; /* поля вокруг иконки */
        background: url("https://static.tildacdn.com/tild6338-3661-4465-b332-643665333939/ChatGPT_Image_12__20.png") center/contain no-repeat;
        opacity: .95; pointer-events: none;
        filter: drop-shadow(0 2px 6px rgba(0,0,0,.25));
      }
      #kb-open-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.20); box-shadow: 0 12px 28px rgba(0,0,0,.32); }
      #kb-open-btn:active{ transform: translateY(1px); }
      @media (max-width:600px){ #kb-open-btn{ width: 92px; height: 92px; } }

      /* Кнопка всегда видима; при открытом оверлее поднимаем поверх и оставляем кликабельной */
      .kb-overlay-open #kb-open-btn{ pointer-events:auto; z-index:2147483602; }
      /* На мобильных скрываем кнопку, когда открыт оверлей */
      @media (hover:none), (pointer:coarse){
        .kb-overlay-open #kb-open-btn{ display:none !important; }
      }
  </style>
    <!-- Overrides: glass-masked calculator button and weather chip -->
    <style>
      /* Glass button exactly in calculator shape (no circular base) */
      #kb-open-btn{
        width: 130px !important; height: 130px !important;
        background: transparent !important; border: 0 !important; border-radius: 0 !important;
        -webkit-backdrop-filter: none !important; backdrop-filter: none !important;
        background-clip: initial !important; box-shadow: none !important; overflow: visible !important;
      }
      #kb-open-btn::before{
        content: ""; position: absolute; inset: 0;
        background: rgba(255,255,255,.16);
        -webkit-backdrop-filter: blur(18px) saturate(160%);
        backdrop-filter: blur(18px) saturate(160%);
        border: 1px solid rgba(255,255,255,.35);
        background-clip: padding-box; box-shadow: 0 8px 22px rgba(0,0,0,.26);
        -webkit-mask-image: url("https://static.tildacdn.com/tild6338-3661-4465-b332-643665333939/ChatGPT_Image_12__20.png");
        -webkit-mask-repeat: no-repeat; -webkit-mask-position: center; -webkit-mask-size: contain;
        mask-image: url("https://static.tildacdn.com/tild6338-3661-4465-b332-643665333939/ChatGPT_Image_12__20.png");
        mask-repeat: no-repeat; mask-position: center; mask-size: contain;
        pointer-events: none;
      }
      /* Remove platform tap/selection highlight around the button */
      #kb-open-btn{ -webkit-tap-highlight-color: transparent; outline: none !important; }
      #kb-open-btn:focus{ outline: none !important; }
      .kb-overlay-open{ -webkit-user-select: none; user-select: none; }
      .no-select{ -webkit-user-select: none !important; user-select: none !important; }
      @supports not ((-webkit-mask-image: url("") ) or (mask-image: url("") )){
        #kb-open-btn::before{ background: transparent; border: 0; box-shadow: none; }
        #kb-open-btn::after{ content: ""; position: absolute; inset: 14px; background: url("https://static.tildacdn.com/tild6338-3661-4465-b332-643665333939/ChatGPT_Image_12__20.png") center/contain no-repeat; filter: drop-shadow(0 2px 6px rgba(0,0,0,.25)); }
      }

      /* Weather chip (glass) — always on desktop; hides on mobile only when overlay open */
      .kb-weather{
        position: fixed; top: 120px; right: 0; z-index: 2147483400;
        padding: 8px 20px 8px 12px; border-radius: 16px 0 0 16px;
        color: #121212; font: 700 16px/1 system-ui;
        background: rgba(255,255,255,.16);
        -webkit-backdrop-filter: blur(18px) saturate(160%);
        backdrop-filter: blur(18px) saturate(160%);
        border: 1px solid rgba(255,255,255,.35);
        background-clip: padding-box;
      }
      @media (hover:none), (pointer:coarse){ .kb-overlay-open .kb-weather{ display:none !important; } }
    </style>
  </head>
  <body>
    <!-- Левый стеклянный сайдбар (как на главной) -->
    <aside class="sidebar">
      <div class="logo">
        <img src="../images/logo.jpg" alt="logo">
        <h2>Калиновая баня</h2>
      </div>
      <ul class="links">
        <h4>Меню</h4>
        <li>
          <span class="material-symbols-outlined">dashboard</span>
          <a href="#">Главная</a>
        </li>
        <li>
          <span class="material-symbols-outlined">show_chart</span>
          <a href="#">Прайс</a>
        </li>
        <li>
          <span class="material-symbols-outlined">flag</span>
          <a href="#">Отчёты</a>
        </li>
        <hr>
        <h4>Дополнительно</h4>
        <li>
          <span class="material-symbols-outlined">person</span>
          <a href="#">Команда</a>
        </li>
        <li>
          <span class="material-symbols-outlined">group</span>
          <a href="#">Гости</a>
        </li>
        <li>
          <span class="material-symbols-outlined">monitoring</span>
          <a href="#">Аналитика</a>
        </li>
        <hr>
        <h4>Аккаунт</h4>
        <li>
          <span class="material-symbols-outlined">mail</span>
          <a href="#">Сообщения</a>
        </li>
        <li>
          <span class="material-symbols-outlined">settings</span>
          <a href="#">Настройки</a>
        </li>
        <li class="logout-link">
          <span class="material-symbols-outlined">logout</span>
          <a href="#">Выйти</a>
        </li>
      </ul>
    </aside>

    <!-- Нативная кнопка “Калькулятор” -->
    <a id="kb-open-btn" aria-label="Открыть бронирование" title="Бронирование"></a>

    <!-- Фулскрин с открытой карточкой (внешний крестик удалён) -->
    <div id="kb-full-overlay" aria-hidden="true">
      <iframe
        id="kb-full-frame"
        title="Калиновая баня — бронирование"
        src="about:blank"
        referrerpolicy="no-referrer">
      </iframe>
    </div>
    <!-- Weather chip (desktop always on) -->
    <div id="kb-weather-chip" class="kb-weather" aria-label="Погода сейчас"><span id="kb-temp">—°</span></div>

    <script>
      (function(){
        var FULL_SRC = '../booking/?hidefab=1&hideweather=1#kb-booking';
        var openBtn = document.getElementById('kb-open-btn');
        var overlay = document.getElementById('kb-full-overlay');
        var full = document.getElementById('kb-full-frame');
        // без внешнего крестика — используем клик по фону / ESC / повторный клик по кнопке
        function isMobile(){
          try { return window.matchMedia('(hover: none), (pointer: coarse)').matches; }
          catch(_) { return window.innerWidth <= 1024; }
        }
        function lockScroll(on){ if (isMobile()) { document.documentElement.classList.toggle('kb-noscroll', on); document.body.classList.toggle('kb-noscroll', on); } }
        function openOverlay(){ if (full.src !== FULL_SRC) full.src = FULL_SRC; overlay.classList.add('is-open'); document.documentElement.classList.add('kb-overlay-open'); lockScroll(true); }
        function closeOverlay(){ overlay.classList.remove('is-open'); document.documentElement.classList.remove('kb-overlay-open'); lockScroll(false); }

        // Слушаем события из booking/ (postMessage)
        window.addEventListener('message', function(e){
          // Внутренний iframe того же домена — принимаем все события
          var d = e.data || {};
          if (d.source === 'kb') {
            if (d.type === 'kb-open') openOverlay();
            else if (d.type === 'kb-close') closeOverlay();
          }
        });

        overlay.addEventListener('click', function(e){ if (e.target === overlay) closeOverlay(); });
        window.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeOverlay(); });
        window.addEventListener('resize', function(){ if (!overlay.classList.contains('is-open')) return; if (isMobile()) lockScroll(true); else lockScroll(false); });
        // На старте сбросим класс (кнопка всегда видима как нативная)
        document.documentElement.classList.remove('kb-overlay-open');
        // Клик по нативной кнопке
        if (openBtn) openBtn.addEventListener('click', function(e){
          e.preventDefault();
          if (overlay.classList.contains('is-open')) closeOverlay(); else openOverlay();
        });
        // Prevent accidental text selection highlight while pressing button
        if (openBtn){
          openBtn.addEventListener('mousedown', function(){ document.body.classList.add('no-select'); });
          document.addEventListener('mouseup', function(){ document.body.classList.remove('no-select'); });
          openBtn.addEventListener('touchstart', function(){ document.body.classList.add('no-select'); }, {passive:true});
          document.addEventListener('touchend', function(){ document.body.classList.remove('no-select'); }, {passive:true});
        }
        // Weather
        try{
          fetch('https://api.open-meteo.com/v1/forecast?latitude=43.6833&longitude=40.2000&current=temperature_2m,weather_code&timezone=auto',{cache:'no-store'})
            .then(r=>r.json()).then(d=>{
              var t = (d && d.current && typeof d.current.temperature_2m==='number') ? Math.round(d.current.temperature_2m) : null;
              var n = document.getElementById('kb-temp'); if(n) n.textContent = (t==null?'—':t)+'°';
            }).catch(()=>{});
        }catch(_){ }
      })();
    </script>
  </body>
</html>
